let e=document.querySelector("#pressure-cv"),n=e.getContext("2d",{alpha:!0,desynchronized:!0}),s=document.querySelector("#final"),i=document.querySelector("#rebirth"),a=document.querySelector("#reset"),o=(document.querySelector("#rebirths span"),document.querySelector("#death-by")),r=document.querySelector("#side-effect-by");const l=[60,60,60];let d,u=e,g=!0,y=!1,M=.6,f=.9,m=1e-4,x=1e-4,$=100,S=0;p.value=M,c.value=f,b.value=m,v.value=x;const w={0:[1,5,8,12],1:[0,2,6,7,9,10],2:[1,4,5,11],3:[3,4]},q={0:"running",1:"teaching",2:"swimming",3:"sleeping",4:"meditating",5:"writing",6:"hiking",7:"stretching",8:"interpreting",9:"climbing",10:"fighting",11:"reading",12:"screaming"},L={0:"injured",1:"ill",2:"tired",3:"moody",4:"relieved",5:"relaxed",6:"neutral",7:"energetic"};let C=[];let N={},I={},P=!1;const k=function(){let e,a,k,R,z,O,F,H,j,J,W,A,D,E;const G=()=>{H=u.width/u.height*5,j=H*H,J=1/H,W=u.width/u.height*5,A=W,D=5*W*Math.random()},T=function(){for(let t=0;t<l.length;t++){let e=`hsla(${Math.round(x/m*35)+40}, 13%, 35%`,n=`hsla(${Math.round(10*f)+11}, 83%, 20%`;if(S>500&&S<=1e3?n=`hsla(${Math.round(x/m/S*45)+160}, 73%, 45%`:S>1e3&&S<=1500?n=`hsla(${Math.round(15*f)+30}, 63%, 45%`:S>1500&&S<=2e3?(e=`hsla(${Math.round(x/m*205)+70}, 63%, 45%`,n=`hsla(${Math.round(20*f)+240}, 60%, 85%`):S>2e3&&S<=2500?(e=`hsla(${Math.round(x/m*115)}, 33%, 45%`,n=`hsla(${Math.round(210*f)+51}, 83%, 35%`):S>2500&&S<=3e3?(e=`hsla(${Math.round(x/m*185)+10}, 53%, 65%`,n=`hsla(${Math.round(215*f)+110}, 63%, 45%`):S>3e3&&S<=3500?(e=`hsla(${Math.round(x/m*115)+10}, 93%, 45%`,n=`hsla(${Math.round(210*f)+51}, 83%, 70%`):S>3500&&S<=4e3?(e=`hsla(${Math.round(x/m*315)+10}, 83%, 55%`,n=`hsla(${Math.round(221*f)+211}, 93%, 20%`):S>4e3&&S<=4500?(e=`hsla(${Math.round(x/m*35)+110}, 13%, 5%`,n=`hsla(${Math.round(130*f)+70}, 73%, 50%`):S>4500&&(e=`hsla(${Math.round(x/m*15)+110}, 33%, 45%`,n=`hsla(${Math.round(100*f)+110}, 73%, 80%`),!P||!N[t]){N[t]=document.createElement("canvas");const e=f*Math.random()*600+200|0;N[t].width=N[t].height=e,P=!0}const s=`${Math.round(1e3*f)}|${Math.round(1e3*m)}|${Math.round(1e3*x)}|${Math.floor(S/500)}`;if(I[t]===s)continue;I[t]=s;const i=N[t].getContext("2d"),a=N[t].width,o=a/2;i.clearRect(0,0,a,a);const r=i.createRadialGradient(o,o,.8,o,o,o);r.addColorStop(0,n+", 1)"),r.addColorStop(.9,e+", 0.05)"),i.fillStyle=r,i.beginPath(),i.arc(o,o,o,0,2*Math.PI,!0),i.closePath(),i.fill()}},B=function(){M=Math.sin(M*(f/M)),f=Math.cos((M-m*x)*f);const l=Math.random();l>.02&&l<.6?(m=Math.sin(m+f/(2500*l)),f-=m*f):l>=.6&&(m=Math.sin(m+f/(1e3*l)),f-=m*f,x>=.5&&(f-=x*f));const u=Math.random();l>=.6?(x=Math.sin(x+m*(1e3*u)),$--):x=l>.02?Math.sin(x-m*(1e3*u)):Math.sin(x+m*(1e3*u)),(M<0||isNaN(M))&&(pressure.classList.add("critical"),M=0,g=!1),(f<1e-5||isNaN(f))&&(c.classList.add("critical"),f=0,g=!1),(m<1e-5||isNaN(m))&&(m=1e-5),(x<1e-5||isNaN(x))&&(x=1e-5),p.value=M,c.value=f,b.value=m,v.value=x,(M<.3||M>=.99)&&(m>=.6||x>=.002)&&(f<.2?(c.classList.add("critical"),$-=M/100/f):c.classList.remove("critical"),M>=.99&&(pressure.classList.add("critical"),$-=M/500/f),x>=.5&&(v.classList.add("critical"),$-=M/100/x),M<1e-4&&(pressure.classList.add("critical"),$=0,g=!1)),x<.5?v.classList.remove("critical"):v.classList.add("critical"),m<.6?b.classList.remove("critical"):b.classList.add("critical"),M>=.3&&M<.99&&f>.2&&f<.999&&(pressure.classList.remove("critical"),c.classList.remove("critical"),$+=M*f/(m/x)),f<.2&&(c.classList.add("critical"),$=0),$>=1&&g&&S%10==0&&function(){const t=Math.floor(Math.random()*Object.keys(L).length),e=Math.floor(Math.random()*Object.keys(w).length),n=q[w[e][Math.floor(Math.random()*w[e].length)]];C.push([n,L[t]]),t<3?f-=2e-6:t>3&&(f+=25e-7),1===t&&(x+=1e-4,m+=1e-4)}();for(let t=0,e=k*R;t<e;t++)O[t].length=0;for(let t=F-1;t>=0;t--)z[t].firstProcess(),z[t].secondProcess();const N=d.getImageData(0,0,e,a),I=N.data;for(let t=0,e=I.length;t<e;t+=4)I[t+2]<10&&(I[t+1]>>=1);if(n.putImageData(N,0,0),T(),g||y)t.textContent=S,S++,requestAnimationFrame(B);else{h.textContent="no",t.textContent=S,i.disabled="";let e=JSON.parse(localStorage.getItem("levvvels-avg-arr"))||[];e.push(S);const n=e.reduce((t,e)=>t+e,0);localStorage.setItem("levvvels-avg-curr",n/e.length),localStorage.setItem("levvvels-avg-arr",JSON.stringify(e)),localStorage.setItem("levvvels-experiences",JSON.stringify(C)),s.querySelector(".ttl span").textContent=S,s.querySelector(".lifespan span").textContent=(n/e.length).toFixed(2),s.querySelector(".rebirths span").textContent=e.length,s.querySelector("#experiences").innerHTML=C.map(t=>`<p>${t[0]} + <em>${t[1]}</em></p>`),s.classList.remove("hidden"),o.textContent=C[C.length-1][0],r.textContent=C[C.length-1][1],y=!0}},K=function(t,e,n){this.type=t,this.x=e,this.y=n,this.px=e,this.py=n,this.vx=0,this.vy=0};function Q(){O=new Array(k*R);for(let t=0;t<O.length;t++)O[t]={length:0,close:[]}}return K.prototype.firstProcess=function(){const t=Math.round(this.x*(1/H)),n=Math.round(this.y*(1/H)),s=O[n*k+t];s&&(s.close[s.length++]=this),this.vx=this.x-this.px,this.vy=this.y-this.py;const i=this.x-Math.random()*e+10,o=this.y-Math.random()*a,r=Math.sqrt(i*i+o*o);if(r<W){const t=r?1/r:0;this.vx+=-i*t,this.vy+=-o*t}this.vx+=.01,this.vy+=.01,this.px=this.x,this.py=this.y,this.x+=this.vx,this.y+=this.vy},K.prototype.secondProcess=function(){let t=0,n=0,s=[];const i=Math.round(this.x*(1/H)),o=Math.round(this.y*(1/H));for(let e=-1;e<2;e++)for(let a=-1;a<2;a++){const r=O[(o+a)*k+(i+e)];if(r&&r.length)for(let e=0;e<r.length;e++){const i=r.close[e];if(i!==this){const e=i.x-this.x,a=i.y-this.y,o=e*e+a*a;if(o<j){const r=Math.sqrt(o),h=1-r*J,l=h*h;t+=l,n+=l*h*.5;const c=r?1/r:0;i.m=h,i.dfx=e*c*h,i.dfy=a*c*h,s.push(i)}}}}t=.99*(t-2);for(let e=0;e<s.length;e++){const i=s[e];let a=t+n*i.m;this.type!==i.type&&(a*=.96*M);const o=i.dfx*a,r=i.dfy*a;i.x+=o,i.y+=r,this.x-=o,this.y-=r}this.x<A?this.x=A:this.x>e-A&&(this.x=e-A),this.y<A?this.y=A:this.y>a-A&&(this.y=a-A),this.draw()},K.prototype.draw=function(){d.drawImage(N[this.type],this.x-D/20,this.y-D/20,D,D)},{init:function(){z=[],u.height=a=innerHeight/2|0,u.width=e=innerWidth/2|0,E=document.createElement("canvas"),E.width=e,E.height=a,d=E.getContext("2d",{willReadFrequently:!0}),G(),T(),k=Math.round(e/H),R=Math.round(a/H),Q();for(let t=0;t<l.length;t++)for(let e=0;e<l[t];e++)z.push(new K(t,Math.random()*innerWidth,Math.random()*innerHeight));F=z.length,B()},resize:function(){const t=e,s=a;u.height=a=innerHeight/2|0,u.width=e=innerWidth/2|0,n=u.getContext("2d",{alpha:!1,desynchronized:!0}),E.width=e,E.height=a,d=E.getContext("2d",{willReadFrequently:!0});const i=e/(t||1),o=a/(s||1);for(let t=0;t<z.length;t++){const e=z[t];e.x*=i,e.y*=o,e.px*=i,e.py*=o}G(),k=Math.round(e/H),R=Math.round(a/H),Q(),T(),d.clearRect(0,0,e,a),n.clearRect(0,0,e,a)}}}();k.init(),i.onclick=function(){document.location.reload()},a.onclick=function(){localStorage.clear(),i.click()},onresize=function(){k.resize()}